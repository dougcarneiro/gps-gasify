<h2 class="p-8 mt-2 flex justify-center font-satisfy text-blue-800 text-5xl">Adicionar Item</h2>
<div *ngIf="isLoading" class="flex justify-center items-center h-24">
  <mat-spinner diameter="36"></mat-spinner>
</div>
<mat-dialog-content [formGroup]="form" *ngIf="!isLoading">
  <div *ngIf="produtoSelecionado" class="mb-4 p-3 bg-blue-50 rounded-md">
    <p class="text-sm text-blue-700">
      <strong>Produto selecionado:</strong> {{ produtoSelecionado.descricao }}<br>
      <strong>Estoque disponível:</strong> {{ produtoSelecionado.quantidadeEstoque }} {{ produtoSelecionado.tipoUnidade }}(s) <br>
      <strong>Preço:</strong> {{ produtoSelecionado.precoPorUnidade | currency:'BRL' }}<br>
    </p>
  </div>
  <mat-form-field class="w-full">

    <mat-label>Produto</mat-label>
    <mat-select formControlName="produto">
      <mat-option *ngFor="let produto of produtos" [value]="produto">
        {{ produto.descricao }}
      </mat-option>
    </mat-select>
  </mat-form-field>


  <mat-form-field class="w-full">
    <mat-label>Quantidade</mat-label>
    <input matInput type="number" formControlName="quantidade" min="1"
           [max]="produtoSelecionado?.quantidadeEstoque!"
           (blur)="onQuantidadeBlur()">
    <mat-error *ngIf="form.get('quantidade')?.hasError('required')">
      Quantidade é obrigatória.
    </mat-error>
    <mat-error *ngIf="form.get('quantidade')?.hasError('min')">
      Quantidade deve ser maior que zero.
    </mat-error>
    <mat-error *ngIf="form.get('quantidade')?.hasError('max') && produtoSelecionado">
      Quantidade não pode ser maior que o estoque disponível.
    </mat-error>
    <mat-error *ngIf="form.get('quantidade')?.hasError('estoqueInsuficiente') && produtoSelecionado">
      Estoque insuficiente! Disponível: {{ produtoSelecionado.quantidadeEstoque }},
      Solicitado: {{ form.get('quantidade')?.errors?.['estoqueInsuficiente']?.quantidadeSolicitada }}
    </mat-error>
  </mat-form-field>
</mat-dialog-content>
<mat-dialog-actions align="end" *ngIf="!isLoading">
  <button mat-button mat-dialog-close>Cancelar</button>
  <button mat-flat-button
    class="w-full md:w-auto md:px-12 !rounded-md !text-md"
    color="primary" [disabled]="form.invalid" (click)="onSubmit()">Confirmar</button>
</mat-dialog-actions>

